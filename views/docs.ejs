<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <style>
        .code-block {
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }
        .endpoint-card {
            border-left: 4px solid #28a745;
        }
        .response-example {
            max-height: 300px;
            overflow-y: auto;
        }
        .nav-pills .nav-link {
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .sticky-top {
            top: 20px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-file-alt me-2"></i>
                Generate Document API
            </a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/templates">Templates</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/docs">API Docs</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <div class="bg-info text-white py-4">
        <div class="container">
            <h1 class="display-5 mb-2">
                <i class="fas fa-book me-3"></i>
                API Documentation
            </h1>
            <p class="lead mb-0">Complete guide to using the Generate Document API</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container my-5">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-3">
                <div class="sticky-top">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-list me-2"></i>
                                Table of Contents
                            </h6>
                        </div>
                        <div class="card-body p-0">
                            <nav class="nav flex-column">
                                <a class="nav-link" href="#overview">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Overview
                                </a>
                                <a class="nav-link" href="#authentication">
                                    <i class="fas fa-lock me-2"></i>
                                    Authentication
                                </a>
                                <a class="nav-link" href="#endpoints">
                                    <i class="fas fa-code me-2"></i>
                                    Endpoints
                                </a>
                                <a class="nav-link" href="#fields">
                                    <i class="fas fa-tags me-2"></i>
                                    Field Types
                                </a>
                                <a class="nav-link" href="#examples">
                                    <i class="fas fa-play me-2"></i>
                                    Examples
                                </a>
                                <a class="nav-link" href="#errors">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    Error Handling
                                </a>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="col-lg-9">
                <!-- Overview -->
                <section id="overview" class="mb-5">
                    <h2><i class="fas fa-info-circle me-2"></i>Overview</h2>
                    <div class="card">
                        <div class="card-body">
                            <p>The Generate Document API allows you to create Word documents (.docx) from predefined templates with dynamic data. The API supports multiple document types and program studi (study programs).</p>
                            
                            <h5>Base URL</h5>
                            <div class="code-block">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-http">http://localhost:3000/api</code></pre>
                            </div>

                            <h5>Supported Formats</h5>
                            <ul>
                                <li><strong>Input:</strong> JSON</li>
                                <li><strong>Output:</strong> Word Document (.docx)</li>
                            </ul>

                            <h5>Available Document Types</h5>
                            <div class="row">
                                <% documentTypes.forEach(doc => { %>
                                    <div class="col-md-6 mb-2">
                                        <span class="badge bg-primary me-2"><%= doc.type.toUpperCase() %></span>
                                        <span class="badge bg-secondary"><%= doc.prodi %></span>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Authentication -->
                <section id="authentication" class="mb-5">
                    <h2><i class="fas fa-lock me-2"></i>Authentication</h2>
                    <div class="card">
                        <div class="card-body">
                            <p>Currently, the API does not require authentication. All endpoints are publicly accessible.</p>
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Note:</strong> Authentication may be added in future versions for security purposes.
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Endpoints -->
                <section id="endpoints" class="mb-5">
                    <h2><i class="fas fa-code me-2"></i>API Endpoints</h2>
                    
                    <!-- Get Document Types -->
                    <div class="card endpoint-card mb-3">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <span class="badge bg-success me-2">GET</span>
                                Get Available Document Types
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="code-block">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-http">GET /api/document-types</code></pre>
                            </div>
                            <p>Returns all available document types and their program studi.</p>
                            
                            <h6>Response Example:</h6>
                            <div class="code-block response-example">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-json">{
  "success": true,
  "data": [
    {
      "type": "kkp",
      "prodi": "informatika",
      "fieldsCount": 8
    },
    {
      "type": "kkp", 
      "prodi": "elektro",
      "fieldsCount": 8
    }
  ]
}</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- Get Available Fields -->
                    <div class="card endpoint-card mb-3">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <span class="badge bg-success me-2">GET</span>
                                Get Available Fields
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="code-block">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-http">GET /api/available-fields/{type}/{prodi}</code></pre>
                            </div>
                            <p>Returns all available fields for a specific document type and program studi.</p>
                            
                            <h6>Parameters:</h6>
                            <ul>
                                <li><code>type</code> - Document type (e.g., "kkp")</li>
                                <li><code>prodi</code> - Program studi (e.g., "informatika")</li>
                            </ul>

                            <h6>Response Example:</h6>
                            <div class="code-block response-example">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-json">{
  "success": true,
  "data": {
    "type": "kkp",
    "prodi": "informatika",
    "document_fields": [
      {
        "field_name": "nama_dosen_pembimbing",
        "field_type": "string",
        "is_required": true,
        "default_value": null
      },
      {
        "field_name": "tanggal_mulai",
        "field_type": "date_masehi", 
        "is_required": true,
        "default_value": null
      }
    ]
  }
}</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- Generate Document -->
                    <div class="card endpoint-card mb-3">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <span class="badge bg-primary me-2">POST</span>
                                Generate Document
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="code-block">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-http">POST /api/generate-document/{type}/{prodi}</code></pre>
                            </div>
                            <p>Generates a Word document with the provided data.</p>
                            
                            <h6>Parameters:</h6>
                            <ul>
                                <li><code>type</code> - Document type (e.g., "kkp")</li>
                                <li><code>prodi</code> - Program studi (e.g., "informatika")</li>
                            </ul>

                            <h6>Request Body Example:</h6>
                            <div class="code-block">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-json">{
  "nama_dosen_pembimbing": "Dr. John Doe",
  "tanggal_mulai": "2024-01-15",
  "tanggal_selesai": "2024-06-15",
  "tableData": [
    {
      "nama": "John Student",
      "nim": "12345678",
      "semester": "8"
    }
  ]
}</code></pre>
                            </div>

                            <h6>Response Example:</h6>
                            <div class="code-block response-example">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-json">{
  "success": true,
  "message": "Document generated successfully",
  "data": {
    "filePath": "1736252800000.docx"
  }
}</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Field Types -->
                <section id="fields" class="mb-5">
                    <h2><i class="fas fa-tags me-2"></i>Field Types</h2>
                    <div class="card">
                        <div class="card-body">
                            <p>The API supports various field types for different data formats:</p>
                            
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>Description</th>
                                            <th>Example</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><code>string</code></td>
                                            <td>Regular text field</td>
                                            <td>"Dr. John Doe"</td>
                                        </tr>
                                        <tr>
                                            <td><code>number</code></td>
                                            <td>Numeric value</td>
                                            <td>123</td>
                                        </tr>
                                        <tr>
                                            <td><code>boolean</code></td>
                                            <td>True/false value</td>
                                            <td>true</td>
                                        </tr>
                                        <tr>
                                            <td><code>date_masehi</code></td>
                                            <td>Gregorian date (YYYY-MM-DD)</td>
                                            <td>"2024-01-15"</td>
                                        </tr>
                                        <tr>
                                            <td><code>date_hijriyah</code></td>
                                            <td>Hijri date (YYYY/MM/DD)</td>
                                            <td>"1445/07/05"</td>
                                        </tr>
                                        <tr>
                                            <td><code>table</code></td>
                                            <td>Array of objects for table data</td>
                                            <td>Array of student objects</td>
                                        </tr>
                                        <tr>
                                            <td><code>array</code></td>
                                            <td>Simple array of values</td>
                                            <td>["item1", "item2"]</td>
                                        </tr>
                                        <tr>
                                            <td><code>text</code></td>
                                            <td>Multi-line text field</td>
                                            <td>"Long description..."</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Examples -->
                <section id="examples" class="mb-5">
                    <h2><i class="fas fa-play me-2"></i>Examples</h2>
                    
                    <!-- cURL Example -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fab fa-linux me-2"></i>
                                cURL Example
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="code-block">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-bash">curl -X POST http://localhost:3000/api/generate-document/kkp/informatika \
  -H "Content-Type: application/json" \
  -d '{
    "nama_dosen_pembimbing": "Dr. John Doe",
    "tanggal_mulai": "2024-01-15",
    "tanggal_selesai": "2024-06-15",
    "tempat_kkp": "PT. Technology Solutions",
    "tableData": [
      {
        "nama": "John Student",
        "nim": "12345678", 
        "semester": "8"
      }
    ]
  }' \
  --output document.docx</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- JavaScript Example -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fab fa-js me-2"></i>
                                JavaScript (Fetch API)
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="code-block">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-javascript">const generateDocument = async () => {
  const response = await fetch('/api/generate-document/kkp/informatika', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      nama_dosen_pembimbing: 'Dr. John Doe',
      tanggal_mulai: '2024-01-15',
      tanggal_selesai: '2024-06-15',
      tempat_kkp: 'PT. Technology Solutions',
      tableData: [
        {
          nama: 'John Student',
          nim: '12345678',
          semester: '8'
        }
      ]
    })
  });

  const result = await response.json();
  
  if (result.success) {
    console.log('Document generated:', result.data.filePath);
  } else {
    console.error('Error:', result.message);
  }
};</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- Python Example -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fab fa-python me-2"></i>
                                Python (Requests)
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="code-block">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-python">import requests
import json

url = 'http://localhost:3000/api/generate-document/kkp/informatika'

data = {
    'nama_dosen_pembimbing': 'Dr. John Doe',
    'tanggal_mulai': '2024-01-15',
    'tanggal_selesai': '2024-06-15',
    'tempat_kkp': 'PT. Technology Solutions',
    'tableData': [
        {
            'nama': 'John Student',
            'nim': '12345678',
            'semester': '8'
        }
    ]
}

response = requests.post(url, json=data)
result = response.json()

if result['success']:
    print(f"Document generated: {result['data']['filePath']}")
else:
    print(f"Error: {result['message']}")
</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Error Handling -->
                <section id="errors" class="mb-5">
                    <h2><i class="fas fa-exclamation-triangle me-2"></i>Error Handling</h2>
                    <div class="card">
                        <div class="card-body">
                            <h5>HTTP Status Codes</h5>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Code</th>
                                            <th>Description</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><code>200</code></td>
                                            <td>Success - Document generated successfully</td>
                                        </tr>
                                        <tr>
                                            <td><code>400</code></td>
                                            <td>Bad Request - Invalid input data</td>
                                        </tr>
                                        <tr>
                                            <td><code>404</code></td>
                                            <td>Not Found - Template not found</td>
                                        </tr>
                                        <tr>
                                            <td><code>500</code></td>
                                            <td>Internal Server Error - Server error</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <h5>Error Response Format</h5>
                            <div class="code-block">
                                <button class="btn btn-sm btn-outline-secondary copy-btn" onclick="copyToClipboard(this)">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <pre><code class="language-json">{
  "success": false,
  "message": "Template tidak ditemukan untuk type: invalid_type, prodi: invalid_prodi",
  "error": "TEMPLATE_NOT_FOUND"
}</code></pre>
                            </div>

                            <h5>Common Error Messages</h5>
                            <ul>
                                <li><strong>Template tidak ditemukan:</strong> Invalid document type or program studi</li>
                                <li><strong>Field wajib tidak boleh kosong:</strong> Required field is missing</li>
                                <li><strong>Data tidak valid:</strong> Invalid data format or type</li>
                                <li><strong>Error generating document:</strong> Internal error during document generation</li>
                            </ul>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4">
        <div class="container text-center">
            <p class="mb-0">
                <i class="fas fa-book me-2"></i>
                Generate Document API - Complete Documentation
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        function copyToClipboard(button) {
            const codeElement = button.nextElementSibling.querySelector('code');
            const text = codeElement.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const originalIcon = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i>';
                button.classList.replace('btn-outline-secondary', 'btn-success');
                
                setTimeout(() => {
                    button.innerHTML = originalIcon;
                    button.classList.replace('btn-success', 'btn-outline-secondary');
                }, 2000);
            });
        }

        // Smooth scroll for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Auto-highlight current section in navigation
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('.nav-link[href^="#"]');

        function highlightCurrentSection() {
            let currentSection = '';
            
            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= 100 && rect.bottom >= 100) {
                    currentSection = section.id;
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').substring(1) === currentSection) {
                    link.classList.add('active');
                }
            });
        }

        window.addEventListener('scroll', highlightCurrentSection);
        highlightCurrentSection(); // Initial call
    </script>
</body>
</html>
